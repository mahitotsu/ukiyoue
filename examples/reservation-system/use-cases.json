[
  {
    "id": "UC-001",
    "title": "予約登録",
    "actor": "SH-CUSTOMER",
    "description": "顧客が予約サイトにアクセスし、希望の日時とサービスを選択して予約を登録する。",
    "preconditions": ["顧客は予約サイトにアクセス可能である", "予約可能な日時と枠が存在する"],
    "postconditions": [
      "予約が確定され、予約番号が発行される",
      "予約データがデータベースに保存される",
      "顧客に予約完了画面が表示される"
    ],
    "mainFlow": [
      {
        "step": 1,
        "description": "顧客が予約サイトにアクセスする",
        "actor": "Customer"
      },
      {
        "step": 2,
        "description": "カレンダーUIで空き状況を表示する",
        "actor": "System"
      },
      {
        "step": 3,
        "description": "顧客が希望の日時を選択する",
        "actor": "Customer"
      },
      {
        "step": 4,
        "description": "利用可能なサービスメニューを表示する",
        "actor": "System"
      },
      {
        "step": 5,
        "description": "顧客がサービスを選択する（複数選択可）",
        "actor": "Customer"
      },
      {
        "step": 6,
        "description": "顧客情報入力フォームを表示する",
        "actor": "System"
      },
      {
        "step": 7,
        "description": "顧客が氏名、電話番号、メールアドレス、特記事項を入力する",
        "actor": "Customer"
      },
      {
        "step": 8,
        "description": "入力内容を検証する",
        "actor": "System"
      },
      {
        "step": 9,
        "description": "予約内容の確認画面を表示する",
        "actor": "System"
      },
      {
        "step": 10,
        "description": "顧客が予約内容を確認し、確定ボタンをクリックする",
        "actor": "Customer"
      },
      {
        "step": 11,
        "description": "予約を確定し、予約番号を発行する",
        "actor": "System"
      },
      {
        "step": 12,
        "description": "予約完了画面を表示し、予約番号を表示する",
        "actor": "System"
      }
    ],
    "alternativeFlows": [
      {
        "id": "AF-1",
        "description": "選択した日時に空きがない場合",
        "branchFrom": 3,
        "steps": [
          {
            "step": 1,
            "description": "空きがないことをメッセージで通知する"
          },
          {
            "step": 2,
            "description": "別の日時の選択を促す"
          }
        ],
        "returnTo": 3
      },
      {
        "id": "AF-2",
        "description": "入力内容にエラーがある場合",
        "branchFrom": 8,
        "steps": [
          {
            "step": 1,
            "description": "エラー内容を表示する"
          },
          {
            "step": 2,
            "description": "該当フィールドをハイライト表示する"
          }
        ],
        "returnTo": 7
      }
    ],
    "exceptionFlows": [
      {
        "id": "EF-1",
        "description": "予約確定中にシステムエラーが発生",
        "steps": [
          {
            "step": 1,
            "description": "入力内容を一時保存する"
          },
          {
            "step": 2,
            "description": "エラーメッセージを表示する"
          },
          {
            "step": 3,
            "description": "顧客にリトライを促す"
          }
        ]
      }
    ],
    "relatedRequirements": ["FR-001"],
    "priority": "critical",
    "frequency": "very-high"
  },
  {
    "id": "UC-002",
    "title": "予約変更",
    "actor": "SH-CUSTOMER",
    "description": "顧客が既存の予約内容（日時やサービス）を変更する。",
    "preconditions": [
      "顧客が予約番号を保持している",
      "予約がキャンセルされていない",
      "変更可能な期限内である"
    ],
    "postconditions": ["予約内容が更新される", "変更完了画面が表示される"],
    "mainFlow": [
      {
        "step": 1,
        "description": "顧客が予約確認ページにアクセスする",
        "actor": "Customer"
      },
      {
        "step": 2,
        "description": "予約番号の入力を求める",
        "actor": "System"
      },
      {
        "step": 3,
        "description": "顧客が予約番号を入力する",
        "actor": "Customer"
      },
      {
        "step": 4,
        "description": "予約内容を検索し、表示する",
        "actor": "System"
      },
      {
        "step": 5,
        "description": "顧客が「変更」ボタンをクリックする",
        "actor": "Customer"
      },
      {
        "step": 6,
        "description": "変更可能な項目を編集可能にする",
        "actor": "System"
      },
      {
        "step": 7,
        "description": "顧客が日時またはサービスを変更する",
        "actor": "Customer"
      },
      {
        "step": 8,
        "description": "変更内容を検証する",
        "actor": "System"
      },
      {
        "step": 9,
        "description": "変更内容の確認画面を表示する",
        "actor": "System"
      },
      {
        "step": 10,
        "description": "顧客が確定ボタンをクリックする",
        "actor": "Customer"
      },
      {
        "step": 11,
        "description": "予約内容を更新する",
        "actor": "System"
      },
      {
        "step": 12,
        "description": "変更完了画面を表示する",
        "actor": "System"
      }
    ],
    "alternativeFlows": [
      {
        "id": "AF-1",
        "description": "予約番号が見つからない場合",
        "branchFrom": 4,
        "steps": [
          {
            "step": 1,
            "description": "予約が見つからないことを通知する"
          },
          {
            "step": 2,
            "description": "予約番号の再入力を促す"
          }
        ],
        "returnTo": 3
      },
      {
        "id": "AF-2",
        "description": "変更期限を過ぎている場合",
        "branchFrom": 5,
        "steps": [
          {
            "step": 1,
            "description": "変更期限を過ぎていることを通知する"
          },
          {
            "step": 2,
            "description": "店舗への直接連絡を案内する"
          }
        ]
      }
    ],
    "exceptionFlows": [],
    "relatedRequirements": ["FR-002"],
    "priority": "high",
    "frequency": "high"
  },
  {
    "id": "UC-003",
    "title": "予約キャンセル",
    "actor": "SH-CUSTOMER",
    "description": "顧客が既存の予約をキャンセルする。",
    "preconditions": [
      "顧客が予約番号を保持している",
      "予約がキャンセルされていない",
      "キャンセル可能な期限内である"
    ],
    "postconditions": [
      "予約がキャンセル状態になる",
      "予約枠が再度利用可能になる",
      "キャンセル完了画面が表示される"
    ],
    "mainFlow": [
      {
        "step": 1,
        "description": "顧客が予約確認ページにアクセスする",
        "actor": "Customer"
      },
      {
        "step": 2,
        "description": "予約番号の入力を求める",
        "actor": "System"
      },
      {
        "step": 3,
        "description": "顧客が予約番号を入力する",
        "actor": "Customer"
      },
      {
        "step": 4,
        "description": "予約内容を検索し、表示する",
        "actor": "System"
      },
      {
        "step": 5,
        "description": "顧客が「キャンセル」ボタンをクリックする",
        "actor": "Customer"
      },
      {
        "step": 6,
        "description": "キャンセル確認ダイアログを表示する",
        "actor": "System"
      },
      {
        "step": 7,
        "description": "顧客がキャンセルを確定する",
        "actor": "Customer"
      },
      {
        "step": 8,
        "description": "予約をキャンセル状態に更新する",
        "actor": "System"
      },
      {
        "step": 9,
        "description": "予約枠を解放する",
        "actor": "System"
      },
      {
        "step": 10,
        "description": "キャンセル完了画面を表示する",
        "actor": "System"
      }
    ],
    "alternativeFlows": [
      {
        "id": "AF-1",
        "description": "キャンセル期限を過ぎている場合",
        "branchFrom": 5,
        "steps": [
          {
            "step": 1,
            "description": "キャンセル期限を過ぎていることを通知する"
          },
          {
            "step": 2,
            "description": "店舗への直接連絡を案内する"
          }
        ]
      }
    ],
    "exceptionFlows": [],
    "relatedRequirements": ["FR-002"],
    "priority": "high",
    "frequency": "medium"
  },
  {
    "id": "UC-004",
    "title": "予約一覧確認",
    "actor": "SH-STAFF",
    "description": "店舗スタッフが当日または特定期間の予約一覧を確認する。",
    "preconditions": [
      {
        "$REF": "UC-009",
        "description": "スタッフログインが完了している"
      }
    ],
    "postconditions": ["予約一覧が表示される", "予約詳細を確認できる"],
    "mainFlow": [
      {
        "step": 1,
        "description": "スタッフが「予約一覧」メニューを選択する",
        "actor": "Staff"
      },
      {
        "step": 2,
        "description": "デフォルトで当日の予約一覧を表示する",
        "actor": "System"
      },
      {
        "step": 3,
        "description": "スタッフが日付や表示形式（日別/週別）を変更する",
        "actor": "Staff"
      },
      {
        "step": 4,
        "description": "指定された条件で予約一覧を再表示する",
        "actor": "System"
      },
      {
        "step": 5,
        "description": "スタッフが予約をクリックして詳細を確認する",
        "actor": "Staff"
      },
      {
        "step": 6,
        "description": "予約詳細情報を表示する",
        "actor": "System"
      }
    ],
    "alternativeFlows": [
      {
        "id": "AF-1",
        "description": "ステータスでフィルタリングする場合",
        "branchFrom": 5,
        "steps": [
          {
            "step": 1,
            "description": "スタッフがステータス（確定/キャンセル/完了）を選択する"
          },
          {
            "step": 2,
            "description": "選択されたステータスの予約のみを表示する"
          }
        ],
        "returnTo": 6
      },
      {
        "id": "AF-2",
        "description": "顧客名で検索する場合",
        "branchFrom": 5,
        "steps": [
          {
            "step": 1,
            "description": "スタッフが顧客名を入力する"
          },
          {
            "step": 2,
            "description": "該当する予約を検索して表示する"
          }
        ],
        "returnTo": 4
      }
    ],
    "exceptionFlows": [],
    "relatedRequirements": ["FR-003"],
    "priority": "high",
    "frequency": "very-high"
  },
  {
    "id": "UC-005",
    "title": "予約ステータス更新",
    "actor": "SH-STAFF",
    "description": "店舗スタッフが予約のステータス（確定/完了/ノーショー）を更新する。",
    "preconditions": [
      {
        "$REF": "UC-009",
        "description": "スタッフログインが完了している"
      },
      "更新対象の予約が存在する"
    ],
    "postconditions": ["予約ステータスが更新される"],
    "mainFlow": [
      {
        "step": 1,
        "description": "スタッフが予約一覧または予約詳細画面を開く",
        "actor": "Staff"
      },
      {
        "step": 2,
        "description": "スタッフが更新対象の予約を選択する",
        "actor": "Staff"
      },
      {
        "step": 3,
        "description": "スタッフがステータス変更ボタンをクリックする",
        "actor": "Staff"
      },
      {
        "step": 4,
        "description": "利用可能なステータス一覧を表示する",
        "actor": "System"
      },
      {
        "step": 5,
        "description": "スタッフが新しいステータスを選択する",
        "actor": "Staff"
      },
      {
        "step": 6,
        "description": "予約ステータスを更新する",
        "actor": "System"
      },
      {
        "step": 7,
        "description": "更新完了メッセージを表示する",
        "actor": "System"
      }
    ],
    "alternativeFlows": [],
    "exceptionFlows": [],
    "relatedRequirements": ["FR-003"],
    "priority": "medium",
    "frequency": "high"
  },
  {
    "id": "UC-006",
    "title": "予約枠設定",
    "actor": "SH-MANAGER",
    "description": "店舗管理者が営業日、営業時間、予約枠の時間間隔を設定する。",
    "preconditions": [
      {
        "$REF": "UC-009",
        "description": "スタッフログインが完了している"
      },
      "管理者権限を持っている"
    ],
    "postconditions": ["予約枠設定が保存される", "設定が予約サイトに即座に反映される"],
    "mainFlow": [
      {
        "step": 1,
        "description": "管理者が「予約枠設定」メニューを選択する",
        "actor": "Manager"
      },
      {
        "step": 2,
        "description": "現在の設定を表示する",
        "actor": "System"
      },
      {
        "step": 3,
        "description": "管理者が営業日・休業日を設定する",
        "actor": "Manager"
      },
      {
        "step": 4,
        "description": "管理者が営業時間を設定する",
        "actor": "Manager"
      },
      {
        "step": 5,
        "description": "管理者が予約枠の時間間隔を設定する",
        "actor": "Manager"
      },
      {
        "step": 6,
        "description": "管理者がサービスごとの所要時間を設定する",
        "actor": "Manager"
      },
      {
        "step": 7,
        "description": "管理者が同時受付可能数を設定する",
        "actor": "Manager"
      },
      {
        "step": 8,
        "description": "入力内容を検証する",
        "actor": "System"
      },
      {
        "step": 9,
        "description": "管理者が「保存」ボタンをクリックする",
        "actor": "Manager"
      },
      {
        "step": 10,
        "description": "設定を保存し、予約枠を再生成する",
        "actor": "System"
      },
      {
        "step": 11,
        "description": "保存完了メッセージを表示する",
        "actor": "System"
      }
    ],
    "alternativeFlows": [
      {
        "id": "AF-1",
        "description": "入力内容にエラーがある場合",
        "branchFrom": 8,
        "steps": [
          {
            "step": 1,
            "description": "エラー内容を表示する"
          },
          {
            "step": 2,
            "description": "該当フィールドをハイライト表示する"
          }
        ],
        "returnTo": 3
      }
    ],
    "exceptionFlows": [],
    "relatedRequirements": ["FR-004"],
    "priority": "medium",
    "frequency": "low"
  },
  {
    "id": "UC-007",
    "title": "予約レポート確認",
    "actor": "SH-MANAGER",
    "description": "店舗管理者が予約実績の統計情報やレポートを確認する。",
    "preconditions": [
      {
        "$REF": "UC-009",
        "description": "スタッフログインが完了している"
      },
      "予約データが存在する"
    ],
    "postconditions": ["レポートが表示される", "必要に応じてCSV出力される"],
    "mainFlow": [
      {
        "step": 1,
        "description": "管理者が「レポート」メニューを選択する",
        "actor": "Manager"
      },
      {
        "step": 2,
        "description": "レポート種類一覧を表示する",
        "actor": "System"
      },
      {
        "step": 3,
        "description": "管理者がレポート種類を選択する（期間別/サービス別/時間帯別など）",
        "actor": "Manager"
      },
      {
        "step": 4,
        "description": "管理者が期間を指定する",
        "actor": "Manager"
      },
      {
        "step": 5,
        "description": "レポートを生成して表示する",
        "actor": "System"
      },
      {
        "step": 6,
        "description": "管理者がレポートを確認する",
        "actor": "Manager"
      },
      {
        "step": 7,
        "description": "管理者が必要に応じて「CSV出力」ボタンをクリックする",
        "actor": "Manager"
      },
      {
        "step": 8,
        "description": "CSVファイルをダウンロード可能にする",
        "actor": "System"
      }
    ],
    "alternativeFlows": [],
    "exceptionFlows": [
      {
        "id": "EF-1",
        "description": "レポート生成に時間がかかる場合",
        "steps": [
          {
            "step": 1,
            "description": "進捗インジケーターを表示する"
          },
          {
            "step": 2,
            "description": "バックグラウンドでレポートを生成する"
          },
          {
            "step": 3,
            "description": "完了後、レポートを表示する"
          }
        ]
      }
    ],
    "relatedRequirements": ["FR-005"],
    "priority": "low",
    "frequency": "medium"
  },
  {
    "id": "UC-008",
    "title": "来店確認（受付処理）",
    "actor": "SH-STAFF",
    "description": "顧客が実際に店舗に来店した際に、店舗スタッフが予約情報を来店済みステータスに更新する受付処理を行う。",
    "preconditions": [
      {
        "$REF": "UC-009",
        "description": "スタッフログインが完了している"
      },
      "顧客の予約が確定状態である",
      "予約日時が当日である"
    ],
    "postconditions": [
      "予約ステータスが「来店済み」に更新される",
      "来店確認時刻が記録される",
      "受付を行ったスタッフ情報が記録される"
    ],
    "mainFlow": [
      {
        "step": 1,
        "description": "顧客が店舗に来店する",
        "actor": "Customer"
      },
      {
        "step": 2,
        "description": "スタッフが顧客に予約の有無を確認する",
        "actor": "Staff"
      },
      {
        "step": 3,
        "description": "スタッフが管理画面の予約一覧を開く",
        "actor": "Staff"
      },
      {
        "step": 4,
        "description": "当日の予約一覧を表示する",
        "actor": "System"
      },
      {
        "step": 5,
        "description": "スタッフが顧客名または予約番号で検索する",
        "actor": "Staff"
      },
      {
        "step": 6,
        "description": "該当する予約を表示する",
        "actor": "System"
      },
      {
        "step": 7,
        "description": "スタッフが予約詳細を確認する",
        "actor": "Staff"
      },
      {
        "step": 8,
        "description": "予約内容（サービス、時間等）を顧客と確認する",
        "actor": "Staff"
      },
      {
        "step": 9,
        "description": "スタッフが「来店確認」ボタンをクリックする",
        "actor": "Staff"
      },
      {
        "step": 10,
        "description": "予約ステータスを「来店済み」に更新する",
        "actor": "System"
      },
      {
        "step": 11,
        "description": "来店確認時刻と受付スタッフ情報を記録する",
        "actor": "System"
      },
      {
        "step": 12,
        "description": "受付完了メッセージを表示する",
        "actor": "System"
      }
    ],
    "alternativeFlows": [
      {
        "id": "AF-1",
        "description": "予約が見つからない場合",
        "branchFrom": 6,
        "steps": [
          {
            "step": 1,
            "description": "予約が見つからないことを通知する"
          },
          {
            "step": 2,
            "description": "スタッフが顧客に予約番号を確認する"
          },
          {
            "step": 3,
            "description": "再度検索を行う、または予約なしとして新規登録を案内する"
          }
        ]
      },
      {
        "id": "AF-2",
        "description": "予約が既にキャンセルされている場合",
        "branchFrom": 7,
        "steps": [
          {
            "step": 1,
            "description": "キャンセル済みであることを通知する"
          },
          {
            "step": 2,
            "description": "スタッフが顧客に状況を説明し、対応を協議する"
          },
          {
            "step": 3,
            "description": "必要に応じて新規予約を登録する"
          }
        ]
      },
      {
        "id": "AF-3",
        "description": "予約時間より早く来店した場合",
        "branchFrom": 8,
        "steps": [
          {
            "step": 1,
            "description": "予約時間と現在時刻の差を表示する"
          },
          {
            "step": 2,
            "description": "スタッフが待ち時間を顧客に案内する"
          },
          {
            "step": 3,
            "description": "スタッフの判断で来店確認を行うか、予定時刻まで待機してもらう"
          }
        ],
        "returnTo": 9
      }
    ],
    "exceptionFlows": [
      {
        "id": "EF-1",
        "description": "システムエラーでステータス更新に失敗",
        "steps": [
          {
            "step": 1,
            "description": "エラーメッセージを表示する"
          },
          {
            "step": 2,
            "description": "スタッフにリトライを促す"
          },
          {
            "step": 3,
            "description": "エラーが継続する場合、手動での記録を案内する"
          }
        ]
      }
    ],
    "relatedRequirements": ["FR-006"],
    "priority": "high",
    "frequency": "very-high"
  },
  {
    "id": "UC-009",
    "title": "スタッフログイン",
    "actor": "SH-STAFF",
    "description": "店舗スタッフまたは管理者が管理画面にアクセスするため、メールアドレスとパスワードで認証を行う。",
    "preconditions": [
      "スタッフアカウントが事前に登録されている",
      "スタッフがログイン認証情報（メールアドレス、パスワード）を保持している"
    ],
    "postconditions": [
      "認証に成功し、セッションが確立される",
      "管理画面のダッシュボードが表示される",
      "セッションタイムアウトが30分に設定される"
    ],
    "mainFlow": [
      {
        "step": 1,
        "description": "スタッフが管理画面のログインページにアクセスする",
        "actor": "Staff"
      },
      {
        "step": 2,
        "description": "ログインフォーム（メールアドレス、パスワード入力欄）を表示する",
        "actor": "System"
      },
      {
        "step": 3,
        "description": "スタッフがメールアドレスを入力する",
        "actor": "Staff"
      },
      {
        "step": 4,
        "description": "スタッフがパスワードを入力する",
        "actor": "Staff"
      },
      {
        "step": 5,
        "description": "スタッフが「ログイン」ボタンをクリックする",
        "actor": "Staff"
      },
      {
        "step": 6,
        "description": "入力されたメールアドレスでスタッフアカウントを検索する",
        "actor": "System"
      },
      {
        "step": 7,
        "description": "保存されたパスワードハッシュ（bcrypt）と入力パスワードを照合する",
        "actor": "System"
      },
      {
        "step": 8,
        "description": "認証に成功した場合、セッションを作成する（30分タイムアウト）",
        "actor": "System"
      },
      {
        "step": 9,
        "description": "CSRFトークンを発行する",
        "actor": "System"
      },
      {
        "step": 10,
        "description": "管理画面のダッシュボードにリダイレクトする",
        "actor": "System"
      },
      {
        "step": 11,
        "description": "ダッシュボードを表示する",
        "actor": "System"
      }
    ],
    "alternativeFlows": [
      {
        "id": "AF-1",
        "description": "メールアドレスが存在しない場合",
        "branchFrom": 6,
        "steps": [
          {
            "step": 1,
            "description": "「メールアドレスまたはパスワードが正しくありません」というエラーメッセージを表示する"
          },
          {
            "step": 2,
            "description": "ログインフォームを再表示する"
          }
        ],
        "returnTo": 3
      },
      {
        "id": "AF-2",
        "description": "パスワードが一致しない場合",
        "branchFrom": 7,
        "steps": [
          {
            "step": 1,
            "description": "「メールアドレスまたはパスワードが正しくありません」というエラーメッセージを表示する"
          },
          {
            "step": 2,
            "description": "ログイン失敗回数をカウントする"
          },
          {
            "step": 3,
            "description": "ログインフォームを再表示する"
          }
        ],
        "returnTo": 3
      },
      {
        "id": "AF-3",
        "description": "入力内容が未入力またはフォーマット不正の場合",
        "branchFrom": 5,
        "steps": [
          {
            "step": 1,
            "description": "入力エラーをフィールド単位で表示する"
          },
          {
            "step": 2,
            "description": "該当フィールドをハイライト表示する"
          }
        ],
        "returnTo": 3
      }
    ],
    "exceptionFlows": [
      {
        "id": "EF-1",
        "description": "短時間に複数回ログイン失敗した場合",
        "steps": [
          {
            "step": 1,
            "description": "アカウントを一時的にロックする（例：5回失敗で15分間ロック）"
          },
          {
            "step": 2,
            "description": "「アカウントが一時的にロックされました」というメッセージを表示する"
          },
          {
            "step": 3,
            "description": "管理者に通知する"
          }
        ]
      },
      {
        "id": "EF-2",
        "description": "セッション作成中にシステムエラーが発生",
        "steps": [
          {
            "step": 1,
            "description": "エラーメッセージを表示する"
          },
          {
            "step": 2,
            "description": "スタッフにリトライを促す"
          }
        ]
      }
    ],
    "relatedRequirements": ["FR-002-06"],
    "priority": "critical",
    "frequency": "very-high"
  }
]
