# ADR-001: Document Format

## Status

Accepted

## Context

Ukiyoue Frameworkでは、プロジェクトドキュメントをどの形式で記述・保存するかを決定する必要があります。この決定は、フレームワーク全体のアーキテクチャに影響を与える最も基本的かつ重要な選択です。

**要求事項**:

- ✅ AI可読性（LLMが生成・解析しやすい）
- ✅ 構造検証（スキーマバリデーション）が可能
- ✅ セマンティック対応（意味・関係性を定義可能）
- ✅ 人間可読性（最終的に人間が理解できる）
- ✅ エコシステム（豊富なツール・ライブラリ）
- ✅ Git親和性（バージョン管理との統合）
- ✅ クロスプラットフォーム対応

**制約条件**:

- AIエージェントが主にドキュメントを生成する（AI-First設計）
- 大規模プロジェクト（10,000+ドキュメント）でも高速に処理
- W3C/IETF標準への準拠が望ましい

## Decision

**JSON** を採用します。

## Options Considered

### Option A: JSON (提案)

**概要**: JavaScript Object Notation。軽量なデータ交換形式で、事実上のWeb標準。

**Pros**:

- ✅ LLMが最も効率的に処理できる（トークン効率、生成精度）
- ✅ JSON Schema (Draft 2020-12) による強力な構造検証
- ✅ JSON-LD 1.1 によるセマンティクス定義（W3C標準）
- ✅ 圧倒的なエコシステム（ツール、ライブラリ、IDE支援）
- ✅ すべての主要プログラミング言語でネイティブサポート
- ✅ 厳密な仕様（RFC 8259）で曖昧性がない

**Cons**:

- ❌ 人間が直接編集するには冗長（括弧、カンマ、引用符が多い）
- ❌ コメントが書けない（標準仕様では）
- ❌ Gitの差分が見づらい場合がある

### Option B: YAML

**概要**: YAML Ain't Markup Language。人間可読性を重視したデータシリアライゼーション形式。

**Pros**:

- ✅ 人間が直接編集しやすい（インデントベース、引用符不要）
- ✅ コメントが書ける
- ✅ Gitの差分が比較的見やすい
- ✅ CI/CD設定など、開発者に馴染み深い

**Cons**:

- ❌ LLMによる生成・解析がJSONより難しい（インデントの扱い）
- ❌ スキーマバリデーションが弱い（JSON Schemaほど厳密でない）
- ❌ セマンティック定義の標準がない（JSON-LD相当の仕様なし）
- ❌ パース結果が実装依存（YAML 1.1 vs 1.2 の非互換）
- ❌ 型の自動変換が曖昧（`yes` が `true` になる等）

### Option C: TOML

**概要**: Tom's Obvious, Minimal Language。設定ファイル向けのシンプルな形式。

**Pros**:

- ✅ 人間が直接編集しやすい
- ✅ コメントが書ける
- ✅ 型が明確
- ✅ ネストが浅い設定に適している

**Cons**:

- ❌ LLMによる生成・解析がやや難しい（構文が独特）
- ❌ スキーマバリデーションの標準がない
- ❌ セマンティック定義の仕組みがない
- ❌ 深いネスト構造の表現が冗長
- ❌ エコシステムが限定的（主にRust, Go界隈）
- ❌ 複雑なデータ構造には不向き

### Option D: XML

**概要**: Extensible Markup Language。古典的だが強力な構造化文書形式。

**Pros**:

- ✅ スキーマバリデーションが強力（XSD, RELAX NG）
- ✅ セマンティック技術が成熟（RDF/XML, OWL）
- ✅ エコシステムが非常に充実（企業向け）
- ✅ 名前空間によるモジュール化が可能

**Cons**:

- ❌ LLMのトークン効率が悪い（冗長な構文）
- ❌ 人間が直接編集するには冗長すぎる
- ❌ モダンな開発環境との親和性が低い
- ❌ JSONと比べてプログラムでの扱いが複雑
- ❌ 重い（ファイルサイズが大きい）

### Option E: Markdown

**概要**: 軽量マークアップ言語。技術文書やREADMEで広く使われている。

**Pros**:

- ✅ 人間が直接編集しやすい（プレーンテキスト）
- ✅ Gitの差分が非常に見やすい
- ✅ LLMが生成しやすい（自然言語ベース）
- ✅ GitHub等でのレンダリング対応
- ✅ 軽量（ファイルサイズが小さい）

**Cons**:

- ❌ 構造検証が弱い（標準的なスキーマがない）
- ❌ セマンティック定義の仕組みがない
- ❌ プログラムによる解析が困難（パーサーが複雑）
- ❌ 厳密なデータ構造の表現に不向き
- ❌ フレーバー間の非互換（CommonMark, GFM, etc.）
- ❌ ネストした構造の表現が限定的

### Option F: Microsoft Office (Word/Excel)

**概要**: ビジネス文書の事実上の標準。現在最も広く使われているドキュメント形式。

**Pros**:

- ✅ ビジネスユーザーに馴染み深い
- ✅ リッチな表現力（書式、図表、埋め込み等）
- ✅ テンプレート機能
- ✅ エンタープライズでの普及率が圧倒的

**Cons**:

- ❌ LLMによる解析・生成が極めて困難（バイナリ形式）
- ❌ プログラムでの処理が複雑（Open XML形式でも煩雑）
- ❌ 構造検証の標準がない
- ❌ セマンティック定義の仕組みがない
- ❌ Gitでのバージョン管理に不向き（差分が見えない）
- ❌ 自動化・CI/CD統合が困難
- ❌ ベンダーロックイン（Microsoft依存）
- ❌ ライセンスコスト

## Comparison Matrix

| 評価基準                       | 重み | JSON     | YAML     | TOML     | XML      | Markdown | MS Office |
| ------------------------------ | ---- | -------- | -------- | -------- | -------- | -------- | --------- |
| **AI可読性**                   | 5    | 5        | 3        | 2        | 2        | 4        | 1         |
| **構造検証**                   | 5    | 5        | 2        | 1        | 5        | 1        | 1         |
| **セマンティック対応**         | 4    | 5        | 1        | 1        | 4        | 1        | 1         |
| **エコシステム**               | 4    | 5        | 4        | 2        | 4        | 3        | 3         |
| **人間可読性**                 | 3    | 3        | 5        | 4        | 1        | 5        | 4         |
| **Git親和性**                  | 3    | 3        | 4        | 4        | 2        | 5        | 1         |
| **バリデーションエコシステム** | 3    | 5        | 2        | 1        | 5        | 1        | 1         |
| **ツールチェーン成熟度**       | 3    | 5        | 3        | 2        | 4        | 3        | 3         |
| **冗長性**                     | 2    | 2        | 4        | 3        | 1        | 5        | 2         |
| **エラーメッセージ**           | 2    | 4        | 3        | 3        | 4        | 2        | 3         |
| **標準化**                     | 1    | 5        | 3        | 4        | 5        | 3        | 2         |
| **合計**                       | -    | **155**  | **104**  | **76**   | **118**  | **100**  | **65**    |
| **正規化スコア（/30）**        | -    | **26.8** | **18.0** | **13.1** | **20.4** | **17.2** | **11.2**  |

**重み付け理由**:

- **AI可読性（5）**: Ukiyoueの核心は「AIと人間の協働」。LLM生成・解析の容易さは最優先事項
- **構造検証（5）**: 自動検証によるミクロの好循環実現に必須
- **セマンティック対応（4）**: 対話可能性（Conversational）の実現に必須
- **エコシステム（4）**: ツール・ライブラリの充実度が開発効率に直結
- **人間可読性（3）**: AIが主に生成するため優先度は中程度
- **Git親和性（3）**: バージョン管理は重要だが、ツールで補完可能
- **バリデーションエコシステム（3）**: 実装品質と開発効率に影響
- **ツールチェーン成熟度（3）**: 実装速度と保守性に影響
- **冗長性（2）**: ファイルサイズへの影響は限定的
- **エラーメッセージ（2）**: 開発体験に影響するが、ラッパーで改善可能
- **標準化（1）**: あれば良いが、デファクトスタンダードで十分

## Consequences

### Positive

- ✅ **AI-First設計の実現**: LLMによる高速・高精度なドキュメント生成が可能
- ✅ **厳密な品質保証**: JSON Schema (Draft 2020-12) による完全な構造検証
- ✅ **セマンティックウェブへの対応**: JSON-LD 1.1 により、W3C標準に準拠したセマンティック定義
- ✅ **開発効率の向上**: 豊富なライブラリ（Ajv, jsonld.js等）により、実装が迅速
- ✅ **将来の拡張性**: JSON Schemaの進化に追従でき、エコシステムの恩恵を継続的に受けられる

### Negative

- ⚠️ 人間による直接編集の難しさ
- ⚠️ コメント記述の制約

### Mitigation

- **人間による直接編集の難しさ**: IDE サポート、AIエージェント活用
- **コメント記述の制約**: `$comment`フィールド、別ファイルドキュメント

## Implementation Notes

```yaml
新規作成が必要な箇所:
  - schemas/: JSON Schemaファイル群
  - semantics/context.jsonld: JSON-LD Context定義
  - examples/: サンプルJSONドキュメント

開発環境への影響:
  - IDE設定: JSON Schema関連付け、フォーマッタ設定
  - Git設定: JSON専用diffツールの検討
  - CI/CD: JSON整形・検証の自動化

移行計画:
  - ステップ1: スキーマファイルの作成（ADR-002）
  - ステップ2: JSON-LD Context定義（ADR-003）
  - ステップ3: サンプルドキュメントの作成
  - ステップ4: バリデーションツールの実装（ADR-004）
```

### 成功基準

- [ ] AI（Claude, GPT-4等）がJSONドキュメントを正確に生成できる
- [ ] JSON Schemaによるバリデーションが100%機能する
- [ ] JSON-LDとしてRDFグラフに変換できる
- [ ] 開発者がIDEでJSON編集時に補完・検証支援を受けられる
- [ ] Gitでの差分管理が実用的なレベルで機能する

### リスクと軽減策

| リスク               | 影響度 | 発生確率 | 軽減策                                          |
| -------------------- | ------ | -------- | ----------------------------------------------- |
| 人間による編集が困難 | 中     | 高       | IDE支援、AIエージェント活用、YAML変換ツール提供 |
| Git差分が見づらい    | 低     | 中       | フォーマッタによる正規化、JSON専用diffツール    |
| コメントが書けない   | 低     | 高       | `$comment`フィールド、別ファイルドキュメント    |
| ファイルサイズの増加 | 低     | 中       | 圧縮、必要に応じてバイナリ形式も検討            |

## Based on

なし（基礎となるADR）
