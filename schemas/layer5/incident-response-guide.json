{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://ukiyoue.example.org/schemas/layer5/incident-response-guide.json",
  "title": "Incident Response Guide",
  "description": "インシデント対応ガイド（OPS-INCIDENT）: 障害発生時の対応手順を定義",
  "allOf": [{ "$ref": "../_common.json#/definitions/baseArtifact" }],
  "type": "object",
  "required": ["title", "incidentDefinition", "escalationFlow"],
  "properties": {
    "@type": {
      "const": "IncidentResponseGuide"
    },
    "title": {
      "type": "string",
      "description": "インシデント対応ガイドのタイトル",
      "minLength": 1
    },
    "incidentDefinition": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["severity", "criteria"],
        "properties": {
          "severity": {
            "type": "string",
            "enum": ["critical", "high", "medium", "low"],
            "description": "重大度レベル"
          },
          "criteria": { "type": "string", "description": "判定基準" },
          "responseTime": { "type": "string", "description": "対応時間目標" }
        }
      },
      "description": "インシデント定義",
      "minItems": 1
    },
    "escalationFlow": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "level": { "type": "string" },
          "contact": { "type": "string" },
          "escalationCriteria": { "type": "string" }
        }
      },
      "description": "エスカレーションフロー: 連絡体制、エスカレーション基準",
      "minItems": 1
    },
    "initialResponse": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "step": { "type": "integer" },
          "action": { "type": "string" }
        }
      },
      "description": "初動対応: 障害検知時の第一アクション、影響範囲特定"
    },
    "recoveryProcedure": {
      "type": "object",
      "properties": {
        "temporaryRecovery": { "type": "string", "description": "一時復旧（Workaround）" },
        "permanentFix": { "type": "string", "description": "恒久対応" }
      },
      "description": "復旧手順"
    },
    "communication": {
      "type": "object",
      "properties": {
        "stakeholderNotification": { "type": "string", "description": "ステークホルダーへの報告" },
        "userNotification": { "type": "string", "description": "ユーザーへの通知" }
      },
      "description": "コミュニケーション"
    },
    "postIncident": {
      "type": "object",
      "properties": {
        "postmortem": { "type": "string", "description": "ポストモーテム" },
        "preventiveMeasures": { "type": "string", "description": "再発防止策" },
        "documentationUpdate": { "type": "string", "description": "ドキュメント更新" }
      },
      "description": "事後対応"
    }
  }
}
