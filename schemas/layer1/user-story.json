{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://ukiyoue.example.org/schemas/layer1/user-story.json",
  "title": "User Story",
  "description": "ユーザーストーリー（USER-STORY）: ユーザー視点での機能要求を記述",
  "allOf": [{ "$ref": "../_common.json#/definitions/baseArtifact" }],
  "type": "object",
  "required": ["title", "asA", "iWant", "soThat", "acceptanceCriteria"],
  "properties": {
    "@type": {
      "const": "UserStory"
    },
    "title": {
      "type": "string",
      "description": "ユーザーストーリーのタイトル",
      "minLength": 1
    },
    "asA": {
      "type": "string",
      "description": "ユーザーロール（As a ...）",
      "minLength": 1
    },
    "iWant": {
      "type": "string",
      "description": "やりたいこと（I want to ...）",
      "minLength": 1
    },
    "soThat": {
      "type": "string",
      "description": "目的・理由（So that ...）",
      "minLength": 1
    },
    "description": {
      "type": "string",
      "description": "ストーリーの詳細説明"
    },
    "acceptanceCriteria": {
      "type": "array",
      "description": "受入基準（Given-When-Then形式）",
      "items": {
        "type": "object",
        "required": ["given", "when", "then"],
        "properties": {
          "given": {
            "type": "string",
            "description": "前提条件（Given）",
            "minLength": 1
          },
          "when": {
            "type": "string",
            "description": "アクション（When）",
            "minLength": 1
          },
          "then": {
            "type": "string",
            "description": "期待結果（Then）",
            "minLength": 1
          }
        }
      },
      "minItems": 1
    },
    "priority": {
      "type": "string",
      "enum": ["must", "should", "could", "wont"],
      "description": "MoSCoW優先度"
    },
    "estimation": {
      "type": "object",
      "description": "見積もり",
      "properties": {
        "storyPoints": {
          "type": "number",
          "description": "ストーリーポイント（フィボナッチ数列推奨: 1,2,3,5,8,13...）"
        },
        "timeEstimate": {
          "type": "string",
          "description": "時間見積もり（例: 2-3日）"
        }
      }
    },
    "persona": {
      "type": "object",
      "description": "ペルソナ情報",
      "properties": {
        "name": { "type": "string", "description": "ペルソナ名" },
        "role": { "type": "string", "description": "役割" },
        "goals": {
          "type": "array",
          "items": { "type": "string" },
          "description": "ペルソナのゴール"
        },
        "painPoints": {
          "type": "array",
          "items": { "type": "string" },
          "description": "ペルソナの課題"
        }
      }
    },
    "relatedBusinessGoals": {
      "type": "array",
      "items": { "type": "string" },
      "description": "関連するビジネス目標ID"
    },
    "dependencies": {
      "type": "array",
      "items": { "type": "string" },
      "description": "依存する他のユーザーストーリーID"
    },
    "epic": {
      "type": "string",
      "description": "所属するエピックID"
    },
    "sprint": {
      "type": "string",
      "description": "割り当てられたスプリント"
    },
    "assignee": {
      "type": "string",
      "description": "担当者"
    },
    "labels": {
      "type": "array",
      "items": { "type": "string" },
      "description": "ラベル・タグ（例: frontend, backend, UX）"
    },
    "notes": {
      "type": "string",
      "description": "その他の備考"
    }
  }
}
