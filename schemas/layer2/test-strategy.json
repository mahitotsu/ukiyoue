{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://ukiyoue.example.org/schemas/layer2/test-strategy.json",
  "title": "Test Strategy",
  "description": "テスト戦略（TEST-STRATEGY）: プロジェクト全体のテスト方針と戦略",
  "allOf": [{ "$ref": "../_common.json#/definitions/baseArtifact" }],
  "type": "object",
  "required": ["title", "scope", "testLevels", "approach"],
  "properties": {
    "@type": {
      "const": "TestStrategy"
    },
    "title": {
      "type": "string",
      "description": "テスト戦略のタイトル",
      "minLength": 1
    },
    "scope": {
      "type": "object",
      "description": "テストスコープ",
      "required": ["inScope"],
      "properties": {
        "inScope": {
          "type": "array",
          "items": { "type": "string" },
          "description": "テスト対象",
          "minItems": 1
        },
        "outOfScope": {
          "type": "array",
          "items": { "type": "string" },
          "description": "テスト対象外"
        }
      }
    },
    "testLevels": {
      "type": "array",
      "description": "テストレベル",
      "items": {
        "type": "object",
        "required": ["level", "objective"],
        "properties": {
          "level": {
            "type": "string",
            "enum": ["unit", "integration", "system", "acceptance"],
            "description": "テストレベル"
          },
          "objective": {
            "type": "string",
            "description": "このレベルの目的"
          },
          "coverage": {
            "type": "object",
            "properties": {
              "target": { "type": "string", "description": "カバレッジ目標" },
              "metric": { "type": "string", "description": "測定方法" }
            }
          },
          "responsibilities": {
            "type": "string",
            "description": "実施責任者・チーム"
          },
          "tools": {
            "type": "array",
            "items": { "type": "string" },
            "description": "使用するツール"
          }
        }
      },
      "minItems": 1
    },
    "approach": {
      "type": "object",
      "description": "テストアプローチ",
      "properties": {
        "methodology": {
          "type": "string",
          "description": "テスト手法（例: TDD, BDD, リスクベース）"
        },
        "automation": {
          "type": "object",
          "properties": {
            "strategy": { "type": "string", "description": "自動化戦略" },
            "scope": {
              "type": "array",
              "items": { "type": "string" },
              "description": "自動化対象範囲"
            },
            "tools": {
              "type": "array",
              "items": { "type": "string" },
              "description": "自動化ツール"
            }
          }
        },
        "dataManagement": {
          "type": "object",
          "properties": {
            "strategy": { "type": "string", "description": "テストデータ戦略" },
            "sources": {
              "type": "array",
              "items": { "type": "string" },
              "description": "データソース"
            }
          }
        },
        "environmentManagement": {
          "type": "object",
          "properties": {
            "environments": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": { "type": "string" },
                  "purpose": { "type": "string" },
                  "configuration": { "type": "string" }
                }
              },
              "description": "テスト環境"
            }
          }
        }
      }
    },
    "testTypes": {
      "type": "array",
      "description": "テストタイプ",
      "items": {
        "type": "object",
        "required": ["type", "description"],
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "functional",
              "performance",
              "security",
              "usability",
              "compatibility",
              "regression",
              "smoke",
              "exploratory"
            ],
            "description": "テストタイプ"
          },
          "description": {
            "type": "string",
            "description": "テストの説明"
          },
          "priority": {
            "type": "string",
            "enum": ["high", "medium", "low"],
            "description": "優先度"
          },
          "schedule": {
            "type": "string",
            "description": "実施タイミング"
          }
        }
      }
    },
    "entryExitCriteria": {
      "type": "object",
      "description": "開始・終了基準",
      "properties": {
        "entry": {
          "type": "array",
          "items": { "type": "string" },
          "description": "テスト開始基準"
        },
        "exit": {
          "type": "array",
          "items": { "type": "string" },
          "description": "テスト終了基準"
        },
        "suspension": {
          "type": "array",
          "items": { "type": "string" },
          "description": "テスト中断基準"
        },
        "resumption": {
          "type": "array",
          "items": { "type": "string" },
          "description": "テスト再開基準"
        }
      }
    },
    "riskManagement": {
      "type": "array",
      "description": "テストリスク",
      "items": {
        "type": "object",
        "required": ["risk", "impact"],
        "properties": {
          "risk": { "type": "string", "description": "リスクの説明" },
          "impact": {
            "type": "string",
            "enum": ["high", "medium", "low"],
            "description": "影響度"
          },
          "probability": {
            "type": "string",
            "enum": ["high", "medium", "low"],
            "description": "発生確率"
          },
          "mitigation": { "type": "string", "description": "軽減策" }
        }
      }
    },
    "deliverables": {
      "type": "array",
      "items": { "type": "string" },
      "description": "テスト成果物（テスト計画、テスト仕様など）"
    }
  },
  "additionalProperties": false
}
